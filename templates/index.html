{% extends "base.html" %}

{% block title %}Dashboard - IBM Video Streaming Manager{% endblock %}

{% block content %}
<div id="dashboard-section">
    <h1>Dashboard</h1>
    <p class="lead">Welcome to IBM Video Streaming Manager</p>
    
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-collection-play"></i> Channels</h5>
                    <p class="card-text">Manage your video channels</p>
                    <button class="btn btn-primary" onclick="loadChannels()">View Channels</button>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-camera-video"></i> Videos</h5>
                    <p class="card-text">Manage your videos</p>
                    <button class="btn btn-primary" onclick="showVideosSection()">View Videos</button>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-graph-up"></i> Analytics</h5>
                    <p class="card-text">View channel analytics</p>
                    <button class="btn btn-primary" onclick="showAnalyticsSection()">View Analytics</button>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-gear"></i> Settings</h5>
                    <p class="card-text">Configure API credentials</p>
                    <a href="{{ url_for('settings') }}" class="btn btn-primary">Go to Settings</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Channels Section -->
<div id="channels-section" style="display: none;">
    <h1>Channels</h1>
    <div class="mb-3">
        <button class="btn btn-secondary" onclick="showDashboard()"><i class="bi bi-arrow-left"></i> Back</button>
        <button class="btn btn-primary" onclick="loadChannels()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
    </div>
    
    <div id="channels-list" class="row">
        <!-- Channels will be loaded here -->
    </div>
</div>

<!-- Videos Section -->
<div id="videos-section" style="display: none;">
    <h1>Video Management</h1>
    
    <div class="mb-3">
        <button class="btn btn-secondary" onclick="showDashboard()"><i class="bi bi-arrow-left"></i> Back</button>
        <button class="btn btn-primary" onclick="loadVideos()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
    </div>
    
    <!-- Channel Selector -->
    <div class="card mb-3">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <label for="channel-select" class="form-label">Select Channel:</label>
                    <select id="channel-select" class="form-select" onchange="onChannelChange()">
                        <option value="">-- Select a channel --</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="page-size-select" class="form-label">Videos per page:</label>
                    <select id="page-size-select" class="form-select" onchange="onPageSizeChange()">
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="200">200</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="search-input" class="form-label">Search:</label>
                    <input type="text" id="search-input" class="form-control" placeholder="Search videos..." onkeyup="onSearchChange()">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Videos Table -->
    <div class="card">
        <div class="card-body">
            <div id="videos-loading" class="text-center" style="display: none;">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
            
            <div id="videos-table-container">
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Duration</th>
                            <th>Views</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="videos-table-body">
                        <tr>
                            <td colspan="6" class="text-center">Select a channel to view videos</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="d-flex justify-content-between align-items-center mt-3">
                <div id="pagination-info">Page 1 of 1 (0 videos)</div>
                <div>
                    <button id="prev-page-btn" class="btn btn-secondary" onclick="loadPreviousPage()" disabled>
                        <i class="bi bi-chevron-left"></i> Previous
                    </button>
                    <button id="next-page-btn" class="btn btn-secondary" onclick="loadNextPage()" disabled>
                        Next <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Analytics Section -->
<div id="analytics-section" style="display: none;">
    <h1>ðŸ“Š Analytics Dashboard</h1>
    
    <div class="mb-3">
        <button class="btn btn-secondary" onclick="showDashboard()"><i class="bi bi-arrow-left"></i> Back</button>
        <button class="btn btn-primary" onclick="refreshAnalytics()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
    </div>
    
    <!-- Channel Selector and Date Range -->
    <div class="card mb-3">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <label for="analytics-channel-select" class="form-label">Select Channel:</label>
                    <select id="analytics-channel-select" class="form-select" onchange="onAnalyticsChannelChange()">
                        <option value="">-- Select a channel --</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="analytics-date-range" class="form-label">Date Range:</label>
                    <select id="analytics-date-range" class="form-select" onchange="onDateRangeChange()">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-success w-100" onclick="exportAnalytics()">
                        <i class="bi bi-download"></i> Export Data
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Analytics Loading -->
    <div id="analytics-loading" class="text-center" style="display: none;">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading analytics data...</p>
    </div>
    
    <!-- Analytics Content -->
    <div id="analytics-content" style="display: none;">
        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">Total Views</h6>
                        <h2 id="total-views" class="card-title">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">Unique Viewers</h6>
                        <h2 id="unique-viewers" class="card-title">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">Peak Viewers</h6>
                        <h2 id="peak-viewers" class="card-title">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">Watch Time</h6>
                        <h2 id="watch-time" class="card-title">-</h2>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Demographics -->
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header">
                        <h5><i class="bi bi-geo-alt"></i> Top Countries</h5>
                    </div>
                    <div class="card-body">
                        <div id="countries-list">
                            <p class="text-muted">No data available</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header">
                        <h5><i class="bi bi-phone"></i> Top Devices</h5>
                    </div>
                    <div class="card-body">
                        <div id="devices-list">
                            <p class="text-muted">No data available</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Detailed Metrics Table -->
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-table"></i> Detailed Metrics</h5>
            </div>
            <div class="card-body">
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Views</th>
                            <th>Unique Viewers</th>
                            <th>Watch Time (hrs)</th>
                        </tr>
                    </thead>
                    <tbody id="metrics-table-body">
                        <tr>
                            <td colspan="4" class="text-center">Select a channel to view analytics</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Alert Container -->
<div id="alert-container"></div>

{% endblock %}

{% block extra_js %}
<script>
let currentChannelId = null;
let currentPage = 1;
let totalPages = 1;
let pageSize = 50;
let searchQuery = '';

// Show/Hide sections
function showDashboard() {
    document.getElementById('dashboard-section').style.display = 'block';
    document.getElementById('channels-section').style.display = 'none';
    document.getElementById('videos-section').style.display = 'none';
    document.getElementById('analytics-section').style.display = 'none';
}

function showVideosSection() {
    document.getElementById('dashboard-section').style.display = 'none';
    document.getElementById('channels-section').style.display = 'none';
    document.getElementById('videos-section').style.display = 'block';
    loadChannelsForSelect();
}

// Load channels
function loadChannels() {
    document.getElementById('dashboard-section').style.display = 'none';
    document.getElementById('channels-section').style.display = 'block';
    document.getElementById('videos-section').style.display = 'none';
    
    $.ajax({
        url: '/api/channels',
        method: 'GET',
        success: function(response) {
            const channelsList = document.getElementById('channels-list');
            channelsList.innerHTML = '';
            
            const channels = response.channels || [];
            channels.forEach(channel => {
                const card = `
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${channel.title || 'Untitled'}</h5>
                                <p class="card-text">ID: ${channel.id}</p>
                                <button class="btn btn-primary btn-sm" onclick="selectChannelForVideos('${channel.id}', '${channel.title}')">
                                    View Videos
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                channelsList.innerHTML += card;
            });
        },
        error: function(xhr) {
            showAlert('Error loading channels: ' + (xhr.responseJSON?.error || 'Unknown error'), 'danger');
        }
    });
}

// Load channels for select dropdown
function loadChannelsForSelect() {
    $.ajax({
        url: '/api/channels',
        method: 'GET',
        success: function(response) {
            const select = document.getElementById('channel-select');
            select.innerHTML = '<option value="">-- Select a channel --</option>';
            
            const channels = response.channels || [];
            channels.forEach(channel => {
                const option = document.createElement('option');
                option.value = channel.id;
                option.textContent = channel.title || 'Untitled';
                select.appendChild(option);
            });
        },
        error: function(xhr) {
            showAlert('Error loading channels: ' + (xhr.responseJSON?.error || 'Unknown error'), 'danger');
        }
    });
}

// Select channel and show videos
function selectChannelForVideos(channelId, channelTitle) {
    showVideosSection();
    document.getElementById('channel-select').value = channelId;
    currentChannelId = channelId;
    currentPage = 1;
    loadVideos();
}

// Channel change handler
function onChannelChange() {
    const select = document.getElementById('channel-select');
    currentChannelId = select.value;
    if (currentChannelId) {
        currentPage = 1;
        loadVideos();
    }
}

// Page size change handler
function onPageSizeChange() {
    pageSize = parseInt(document.getElementById('page-size-select').value);
    currentPage = 1;
    loadVideos();
}

// Search change handler
let searchTimeout;
function onSearchChange() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        searchQuery = document.getElementById('search-input').value;
        currentPage = 1;
        loadVideos();
    }, 500);
}

// Load videos
function loadVideos() {
    if (!currentChannelId) {
        return;
    }
    
    document.getElementById('videos-loading').style.display = 'block';
    document.getElementById('videos-table-container').style.display = 'none';
    
    const params = {
        page: currentPage,
        page_size: pageSize
    };
    if (searchQuery) {
        params.search = searchQuery;
    }
    
    $.ajax({
        url: `/api/channels/${currentChannelId}/videos`,
        method: 'GET',
        data: params,
        success: function(response) {
            document.getElementById('videos-loading').style.display = 'none';
            document.getElementById('videos-table-container').style.display = 'block';
            
            const videos = response.videos || [];
            const paging = response.paging || {};
            
            // Use the total from paging info (this is the actual total count from API)
            const total = paging.total || 0;
            const actualCount = paging.actual_count || videos.length;
            
            // Calculate total pages based on the actual total count
            totalPages = Math.max(1, Math.ceil(total / pageSize));
            
            // Update pagination info with more details
            const startNum = total > 0 ? ((currentPage - 1) * pageSize) + 1 : 0;
            const endNum = Math.min(currentPage * pageSize, total);
            
            document.getElementById('pagination-info').textContent =
                `Showing ${startNum}-${endNum} of ${total} videos (Page ${currentPage} of ${totalPages})`;
            
            // Enable/disable pagination buttons
            document.getElementById('prev-page-btn').disabled = currentPage <= 1;
            document.getElementById('next-page-btn').disabled = currentPage >= totalPages || total === 0;
            
            // Update table
            const tbody = document.getElementById('videos-table-body');
            tbody.innerHTML = '';
            
            if (videos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">No videos found</td></tr>';
                return;
            }
            
            videos.forEach(video => {
                const isPublic = video.protect === 'public';
                const statusClass = isPublic ? 'status-public' : 'status-private';
                const statusText = isPublic ? 'Public' : 'Private';
                const toggleBtnClass = isPublic ? 'btn-warning' : 'btn-success';
                const toggleBtnText = isPublic ? 'Make Private' : 'Make Public';
                
                const duration = formatDuration(video.length);
                
                const row = `
                    <tr id="video-row-${video.id}">
                        <td>${video.id}</td>
                        <td>${video.title || 'Untitled'}</td>
                        <td>${duration}</td>
                        <td>${video.views || 0}</td>
                        <td class="${statusClass}">${statusText}</td>
                        <td>
                            <button class="btn ${toggleBtnClass} btn-sm" onclick="toggleVideoStatus('${video.id}', ${isPublic})">
                                ${toggleBtnText}
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        },
        error: function(xhr) {
            document.getElementById('videos-loading').style.display = 'none';
            document.getElementById('videos-table-container').style.display = 'block';
            showAlert('Error loading videos: ' + (xhr.responseJSON?.error || 'Unknown error'), 'danger');
        }
    });
}

// Toggle video status
function toggleVideoStatus(videoId, isCurrentlyPublic) {
    const makePrivate = isCurrentlyPublic;
    const newStatus = makePrivate ? 'private' : 'public';
    
    // Find the button and show loading state
    const button = event.target;
    const originalText = button.textContent;
    button.disabled = true;
    button.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Updating...';
    
    // Optimistically update the status cell
    const row = document.getElementById(`video-row-${videoId}`);
    const statusCell = row.querySelector('td:nth-child(5)');
    const originalStatusText = statusCell.textContent;
    const originalStatusClass = statusCell.className;
    statusCell.textContent = newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
    statusCell.className = makePrivate ? 'status-private' : 'status-public';
    
    $.ajax({
        url: `/api/videos/${videoId}/protection`,
        method: 'PUT',
        contentType: 'application/json',
        data: JSON.stringify({ is_private: makePrivate }),
        success: function(response) {
            // Check if status actually changed
            if (response.status_changed) {
                showAlert(`âœ“ Video is now ${response.actual_status}`, 'success');
                // Update button
                button.textContent = makePrivate ? 'Make Public' : 'Make Private';
                button.className = makePrivate ? 'btn btn-success btn-sm' : 'btn btn-warning btn-sm';
                button.disabled = false;
                button.onclick = function() { toggleVideoStatus(videoId, !makePrivate); };
            } else {
                // Revert if change failed
                showAlert(`âš  Status change failed. Video remains ${response.actual_status}`, 'warning');
                statusCell.textContent = originalStatusText;
                statusCell.className = originalStatusClass;
                button.textContent = originalText;
                button.disabled = false;
            }
        },
        error: function(xhr) {
            // Revert on error
            showAlert('Error updating video status: ' + (xhr.responseJSON?.error || 'Unknown error'), 'danger');
            statusCell.textContent = originalStatusText;
            statusCell.className = originalStatusClass;
            button.textContent = originalText;
            button.disabled = false;
        }
    });
}

// Pagination
function loadPreviousPage() {
    if (currentPage > 1) {
        currentPage--;
        loadVideos();
    }
}

function loadNextPage() {
    if (currentPage < totalPages) {
        currentPage++;
        loadVideos();
    }
}

// Helper functions
function formatDuration(seconds) {
    if (!seconds || seconds === '0') return '0:00';
    const sec = parseInt(seconds);
    const hours = Math.floor(sec / 3600);
    const minutes = Math.floor((sec % 3600) / 60);
    const secs = sec % 60;
    
    if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    return `${minutes}:${secs.toString().padStart(2, '0')}`;
}

function showAlert(message, type) {
    const alertHtml = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    document.getElementById('alert-container').innerHTML = alertHtml;
    
    // Auto-dismiss after 5 seconds
    setTimeout(() => {
        const alert = document.querySelector('.alert');
        if (alert) {
            alert.remove();
        }
    }, 5000);
}

// Analytics Section
let currentAnalyticsChannelId = null;
let currentDateRange = 30;

function showAnalyticsSection() {
    document.getElementById('dashboard-section').style.display = 'none';
    document.getElementById('channels-section').style.display = 'none';
    document.getElementById('videos-section').style.display = 'none';
    document.getElementById('analytics-section').style.display = 'block';
    loadChannelsForAnalytics();
}

function loadChannelsForAnalytics() {
    $.ajax({
        url: '/api/channels',
        method: 'GET',
        success: function(response) {
            const select = document.getElementById('analytics-channel-select');
            select.innerHTML = '<option value="">-- Select a channel --</option>';
            
            const channels = response.channels || [];
            channels.forEach(channel => {
                const option = document.createElement('option');
                option.value = channel.id;
                option.textContent = channel.title || 'Untitled';
                select.appendChild(option);
            });
        },
        error: function(xhr) {
            showAlert('Error loading channels: ' + (xhr.responseJSON?.error || 'Unknown error'), 'danger');
        }
    });
}

function onAnalyticsChannelChange() {
    const select = document.getElementById('analytics-channel-select');
    currentAnalyticsChannelId = select.value;
    if (currentAnalyticsChannelId) {
        loadAnalytics();
    }
}

function onDateRangeChange() {
    currentDateRange = parseInt(document.getElementById('analytics-date-range').value);
    if (currentAnalyticsChannelId) {
        loadAnalytics();
    }
}

function refreshAnalytics() {
    if (currentAnalyticsChannelId) {
        loadAnalytics();
    } else {
        showAlert('Please select a channel first', 'warning');
    }
}

function loadAnalytics() {
    if (!currentAnalyticsChannelId) {
        return;
    }
    
    document.getElementById('analytics-loading').style.display = 'block';
    document.getElementById('analytics-content').style.display = 'none';
    
    // Load metrics
    $.ajax({
        url: `/api/analytics/channels/${currentAnalyticsChannelId}/metrics`,
        method: 'GET',
        data: { days: currentDateRange },
        success: function(metricsResponse) {
            // Load demographics
            $.ajax({
                url: `/api/analytics/channels/${currentAnalyticsChannelId}/demographics`,
                method: 'GET',
                data: { days: currentDateRange },
                success: function(demoResponse) {
                    displayAnalytics(metricsResponse, demoResponse);
                },
                error: function(xhr) {
                    // Show metrics even if demographics fail
                    displayAnalytics(metricsResponse, {});
                    showAlert('Warning: Could not load demographics', 'warning');
                }
            });
        },
        error: function(xhr) {
            document.getElementById('analytics-loading').style.display = 'none';
            showAlert('Error loading analytics: ' + (xhr.responseJSON?.error || 'Unknown error'), 'danger');
        }
    });
}

function displayAnalytics(metrics, demographics) {
    document.getElementById('analytics-loading').style.display = 'none';
    document.getElementById('analytics-content').style.display = 'block';
    
    // Calculate summary statistics from data
    const data = metrics.data || [];
    let totalViews = 0;
    let totalUniqueViewers = 0;
    let totalWatchTime = 0;
    let peakViewers = 0;
    
    data.forEach(item => {
        totalViews += parseInt(item.views || 0);
        totalUniqueViewers += parseInt(item.unique_viewers || 0);
        totalWatchTime += parseInt(item.watch_time || 0);
        peakViewers = Math.max(peakViewers, parseInt(item.peak_viewers || 0));
    });
    
    // Update summary cards
    document.getElementById('total-views').textContent = formatNumber(totalViews);
    document.getElementById('unique-viewers').textContent = formatNumber(totalUniqueViewers);
    document.getElementById('peak-viewers').textContent = formatNumber(peakViewers);
    document.getElementById('watch-time').textContent = formatWatchTime(totalWatchTime);
    
    // Display demographics
    displayDemographics(demographics);
    
    // Display detailed metrics table
    displayMetricsTable(data);
}

function displayDemographics(demographics) {
    // Countries
    const countriesList = document.getElementById('countries-list');
    const countries = demographics.countries || [];
    
    if (countries.length === 0) {
        countriesList.innerHTML = '<p class="text-muted">No data available</p>';
    } else {
        let html = '<div class="list-group list-group-flush">';
        countries.slice(0, 10).forEach(country => {
            const percentage = country.percentage || 0;
            html += `
                <div class="list-group-item bg-transparent border-0 d-flex justify-content-between align-items-center">
                    <span>${country.name || 'Unknown'}</span>
                    <span class="badge bg-primary rounded-pill">${percentage.toFixed(1)}%</span>
                </div>
            `;
        });
        html += '</div>';
        countriesList.innerHTML = html;
    }
    
    // Devices
    const devicesList = document.getElementById('devices-list');
    const devices = demographics.devices || [];
    
    if (devices.length === 0) {
        devicesList.innerHTML = '<p class="text-muted">No data available</p>';
    } else {
        let html = '<div class="list-group list-group-flush">';
        devices.forEach(device => {
            const percentage = device.percentage || 0;
            html += `
                <div class="list-group-item bg-transparent border-0 d-flex justify-content-between align-items-center">
                    <span>${device.name || 'Unknown'}</span>
                    <span class="badge bg-primary rounded-pill">${percentage.toFixed(1)}%</span>
                </div>
            `;
        });
        html += '</div>';
        devicesList.innerHTML = html;
    }
}

function displayMetricsTable(data) {
    const tbody = document.getElementById('metrics-table-body');
    
    if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="text-center">No data available</td></tr>';
        return;
    }
    
    tbody.innerHTML = '';
    data.forEach(item => {
        const date = item.date || 'N/A';
        const views = formatNumber(item.views || 0);
        const uniqueViewers = formatNumber(item.unique_viewers || 0);
        const watchTimeHours = ((item.watch_time || 0) / 3600).toFixed(1);
        
        const row = `
            <tr>
                <td>${date}</td>
                <td>${views}</td>
                <td>${uniqueViewers}</td>
                <td>${watchTimeHours}</td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

function exportAnalytics() {
    if (!currentAnalyticsChannelId) {
        showAlert('Please select a channel first', 'warning');
        return;
    }
    
    showAlert('Export functionality coming soon!', 'info');
}

function formatNumber(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function formatWatchTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    
    if (hours > 0) {
        return `${hours}h ${minutes}m`;
    }
    return `${minutes}m`;
}
</script>
{% endblock %}